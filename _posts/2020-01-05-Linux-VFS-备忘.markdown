---
layout: post
title: "Linux VFS 备忘"
categories: Linux
---

# Linux VFS

## 简介

VFS (Virtual File System)，虚拟文件系统。异构文件系统数据编码形式各异，Linux内核通过抽象文件系统操作，在异构文件系统与Linux内核间添加了一层虚拟层，对内核屏蔽底层异构文件系统实现上的差异，同时也有利于扩展别的文件系统，是一种微内核架构的体现。

## 原理

VFS抽象的通用文件模型中包含四种数据结构：

- 超级块对象（superblock），用于存放已经注册的文件系统的信息。
- 索引节点对象（inode），用于存放具体文件的信息。
- 文件对象（file），文件对象表示进程内打开的文件，文件对象存放在进程文件描述符表里面。
- 目录项对象（dentry）， 在每个文件系统中，内核在查找某一个路径中的文件时，会为内核路径上的每一个分量都生成一个目录项对象，通过目录项对象能够找到对应的 inode 对象，目录项对象一般会被缓存，从而提高内核查找速度。 

## 应用

通过实现内核对VFS相关数据结构的具体操作，可以构建某个自定义的实际文件系统。

## 启示 

VFS通过总结内核对文件系统的操作，抽象相关数据结构，构建出内核与实际文件系统之间的抽象层，向上屏蔽了异构文件系统间的差异，使得内核实现更加优雅、高效。这也是微内核+模块化的优势体现，抽象出文件系统核心不变的点，将可变点隔离在内核之外，保持了内核的稳定性与普适性，这种思想值得借鉴学习。